var PM={$container:$(".js_container"),_pageStack:[],_configs:[],_defaultPage:null,"default":function(a){return this._defaultPage=a,this},init:function(){var a=this;return a.go(a._defaultPage),this},push:function(a){return this._configs.push(a),this},go:function(a){var c,d,b=this._find("name",a);if(b)return b.isBind||this._bind(b),c=$(b.template).html(),d=$(c).addClass("slideIn").addClass(b.name),this.$container.append(d),this._pageStack.push({config:b,dom:d}),this},back:function(){var a=this._pageStack.pop();if(a)return a.dom.addClass("slideOut").on("animationend",function(){a.dom.remove()}).on("webkitAnimationEnd",function(){a.dom.remove()}),0!=this._pageStack.length?this:(WeixinJSBridge.call("closeWindow"),void 0)},_find:function(a,b){var d,e,c=null;for(d=0,e=this._configs.length;e>d;d++)if(this._configs[d][a]===b){c=this._configs[d];break}return c},_bind:function(a){var c,d,b=a.events||{};for(c in b)for(d in b[c])this.$container.on(d,c,b[c][d]);a.isBind=!0}},home={name:"home",template:"#tpl_home",events:{".js_grid":{click:function(){function b(a){$("#bsn").html($("#n"+a).text()),$("#bdr").html($("#r"+a).text()),$("#bic").attr("class",function(){var c,d,b=$("#o"+a).attr("class"),e="";return b.indexOf("success")>0?(ast.state="in",c="在箱可借",d="可到钥匙箱通过指纹验证提取使用",e="weui_icon_success"):b.indexOf("wait")>0?(ast.state="out",c="借出待还",d="点击操作选项可预定归还提醒或主动催还",e="weui_icon_waiting"):(ast.state="miss",c="已遗失",d="钥匙找回后请及时联系管理员更新",e="weui_icon_warn"),$("#bst").html(c),$("#btp").html(d),"weui_icon_msg "+e})}var a=$(this).data("id");home.id=parseInt($(this).data("k")),PM.go(a),b(home.id),$.ajax({type:"GET",url:"/smartkey/"+home.id,dataType:"json",success:function(a){$("#bsr").html(a.name),$("#btm").html(a.date),$("#bsb").html(a.subscribers)}}),ast.tgbtn()}}}},ast={hideast:function(a,b){$("#dialog1").hide(),a.removeClass("weui_actionsheet_toggle"),b.removeClass("weui_fade_toggle"),a.on("transitionend",function(){b.hide()}).on("webkitTransitionEnd",function(){b.hide()})},tgbtn:function(){$("#scb").toggleClass("out"==this.state?"":"dead"),$("#urg").toggleClass("out"==this.state?"":"dead"),$("#rpt").toggleClass("miss"==this.state?"dead":"")},name:"ast",template:"#tpl_ast",events:{"#showast":{click:function(){var a=$("#mask"),b=$("#weui_ast");b.addClass("weui_actionsheet_toggle"),a.show().addClass("weui_fade_toggle").one("click",function(){ast.hideast(b,a)}),$("#ast_cancel").one("click",function(){ast.hideast(b,a)}),b.unbind("transitionend").unbind("webkitTransitionEnd")}},"#back":{click:function(){ast.tgbtn(),PM.back()}},"#menu .weui_actionsheet_cell":{click:function(){function c(a){var b=$("#toast");"none"==b.css("display")&&(b.find("i").attr("class",200==a.result?"weui_icon_toast":403==a.result?"weui_icon_safe_warn":"weui_icon_warn"),b.find("p").text(a.msg),b.show(),setTimeout(function(){b.hide()},2e3),""!=a.ps&&$("#bsb").html(function(b,c){return"无"==c.substr(0,1)&&(c=c.substr(1)),c+" "+a.ps}))}var b,a=$("#dialog1");$(this).attr("class").indexOf("dead")>0||"none"!=a.css("display")||(b=$(this).attr("id"),$("#warnbd").text("scb"==b?"登记成功后，该钥匙到箱时公众号会给您发送一条提取通知":"urg"==b?"通过本公众号给该钥匙的借用者发送一条催还提醒":"向管理员报告登记该钥匙已丢失"),a.show(),$("#confirm").one("click",function(){$.ajax({type:"POST",url:"/smartkey/"+home.id+"?_method=put&rq="+b,dataType:"json",success:function(a){c(a)},error:function(){c({msg:"操作失败",result:404})}}),ast.hideast($("#weui_ast"),$("#mask"))}),$("#cancel").one("click",function(){ast.hideast($("#weui_ast"),$("#mask"))}))}}}};